#!/bin/bash

set -euo pipefail

if [[ $* == *-j* ]]; then
    echo '{
  "desc": "Livepeer-packaged CockroachDB",
  "name": "Livepeer CockroachDB",
  "optional": {}
}'
    exit 0
fi

bash <<EOF &
  until cockroach sql --url 'postgresql://root@localhost:5432/defaultdb?sslmode=disable' < /tmp/catalyst-fixtures.sql; do
    sleep 1;
  done
EOF

exec cockroach start-single-node --insecure --listen-addr=localhost:36257 --sql-addr=0.0.0.0:5432 --http-addr=127.0.0.1:18080 -s /data/cockroach
